<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Taverna War RPG - Web Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #0c0a08; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Verdana', sans-serif; }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
    const config = {
        type: Phaser.AUTO,
        width: 1200,
        height: 900,
        parent: 'game-container',
        scene: { preload: preload, create: create, update: update }
    };

    const game = new Phaser.Game(config);

    // Данные игрока (согласно твоим механикам)
    let player = {
        job: 'Воин',
        hp: 300, maxHp: 300,
        gold: 0, mana: 0,
        level: 1, atk: 25, exp: 0,
        skillName: "Ярость: Взрыв Крови"
    };

    let mob = { name: "Орк-Тиран", hp: 150, maxHp: 150, atk: 18 };
    let gameLog = ["Соберите 100 маны для Ульты!"];

    function preload() {
        // Загрузка твоих ассетов (пути проверены по твоим скриншотам)
        this.load.image('hero_Воин', 'assets/hero_warrior.png');
        this.load.image('hero_Маг', 'assets/hero_mage.png');
        this.load.image('hero_Лучник', 'assets/archer.png');
        this.load.image('hero_Ассасин', 'assets/assasin.png');

        this.load.image('tile_Red', 'assets/rune_red.png');
        this.load.image('tile_Blue', 'assets/rune_blue.png');
        this.load.image('tile_Green', 'assets/rune_green.png');
        this.load.image('tile_Purple', 'assets/rune_purple.png');
        this.load.image('tile_Yellow', 'assets/rune_yellow.png');
    }

    function create() {
        // Фоновая панель
        let panel = this.add.graphics();
        panel.fillStyle(0x191614, 1);
        panel.fillRoundedRect(20, 20, 310, 860, 20);
        panel.lineStyle(2, 0xb48c46, 1);
        panel.strokeRoundedRect(20, 20, 310, 860, 20);

        // Тексты интерфейса
        this.jobText = this.add.text(40, 40, `${player.job} LVL ${player.level}`, { fontSize: '24px', color: '#fff', foneStyle: 'bold' });
        this.goldText = this.add.text(40, 80, `Золото: ${player.gold}`, { fontSize: '18px', color: '#ffd700' });
        
        // Отрисовка HP и Mana баров
        this.hpBar = this.add.graphics();
        this.manaBar = this.add.graphics();

        // Картинка героя
        this.heroSprite = this.add.image(175, 450, 'hero_Воин').setScale(0.8);

        // Игровое поле
        const types = ['Red', 'Blue', 'Green', 'Purple', 'Yellow'];
        this.tiles = [];
        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                let type = Phaser.Utils.Array.GetRandom(types);
                let tile = this.add.image(400 + c * 68, 150 + r * 68, `tile_${type}`).setInteractive();
                tile.setDisplaySize(60, 60);
                tile.tileType = type;
                tile.on('pointerdown', () => handleTileClick(tile, this));
            }
        }

        // Лог
        this.logDisplay = this.add.text(400, 750, gameLog.join('\n'), { fontSize: '16px', color: '#b4aa96', fontFamily: 'Courier' });

        // Моб
        this.mobNameText = this.add.text(950, 40, mob.name, { fontSize: '22px', color: '#ff4444' });
        this.mobHpBar = this.add.graphics();

        updateUI(this);
    }

    function handleTileClick(tile, scene) {
        // Механика рун
        if (tile.tileType === 'Red') mob.hp -= Math.floor(player.atk / 2);
        if (tile.tileType === 'Blue') player.mana = Math.min(100, player.mana + 15);
        if (tile.tileType === 'Green') player.hp = Math.min(player.maxHp, player.hp + 20);
        if (tile.tileType === 'Yellow') player.gold += 10;
        if (tile.tileType === 'Purple') mob.hp -= player.atk;

        addLog(`Собрана руна: ${tile.tileType}`, scene);

        // Анимация "удаления" и замены руны
        scene.tweens.add({
            targets: tile,
            scale: 0,
            duration: 100,
            onComplete: () => {
                const types = ['Red', 'Blue', 'Green', 'Purple', 'Yellow'];
                tile.tileType = Phaser.Utils.Array.GetRandom(types);
                tile.setTexture(`tile_${tile.tileType}`);
                scene.tweens.add({ targets: tile, scale: 0.6, duration: 100 });
                checkBattleStatus(scene);
                updateUI(scene);
            }
        });
    }

    function checkBattleStatus(scene) {
        if (mob.hp <= 0) {
            addLog("ПОБЕДА! Получено золото.", scene);
            player.gold += 50;
            mob.hp = mob.maxHp; // Спавн нового
        }
    }

    function addLog(msg, scene) {
        gameLog.push("> " + msg);
        if (gameLog.length > 5) gameLog.shift();
        scene.logDisplay.setText(gameLog.join('\n'));
    }

    function updateUI(scene) {
        // Обновление баров
        scene.hpBar.clear().fillStyle(0x3c0000).fillRect(40, 110, 270, 20).fillStyle(0xdc2828).fillRect(40, 110, (player.hp / player.maxHp) * 270, 20);
        scene.manaBar.clear().fillStyle(0x141464).fillRect(40, 140, 270, 10).fillStyle(0x2878ff).fillRect(40, 140, (player.mana / 100) * 270, 10);
        scene.mobHpBar.clear().fillStyle(0x3c0000).fillRect(950, 80, 220, 15).fillStyle(0xdc2828).fillRect(950, 80, (Math.max(0, mob.hp) / mob.maxHp) * 220, 15);
        scene.goldText.setText(`Золото: ${player.gold}`);
    }

    function update() {}
    </script>
</body>
</html>
