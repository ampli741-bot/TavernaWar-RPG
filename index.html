<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Taverna War: Gothic Perfection</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        :root { 
            --gold: #ffd700; --border: #b48c46; --bg: #0c0a08;
            --rar0: #b0b0b0; --rar1: #4488ff; --rar2: #aa44ff; --rar3: #ffaa00;
        }
        body { 
            margin: 0; 
            background: #000; 
            color: white; display: flex; height: 100vh; overflow: hidden; 
            font-family: 'Verdana', sans-serif; touch-action: none; 
        }

        /* Декоративные челюсти/рамки из скриншота */
        .frame-decoration {
            position: absolute; width: 100%; height: 100%;
            pointer-events: none; z-index: 5;
            background-image: url('assets/frame_teeth.png'); /* Предполагаем наличие декора */
            background-size: contain; background-repeat: no-repeat;
        }

        #ui-left, #ui-right { 
            width: 380px; padding: 20px; background: rgba(5, 5, 5, 0.95); 
            display: flex; flex-direction: column; border: 2px solid #2a2010; 
            box-sizing: border-box; z-index: 10; position: relative;
            box-shadow: inset 0 0 50px #000;
        }

        #game-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }

        /* Стили портрета как на скрине */
        .portrait-container {
            position: relative; width: 260px; height: 260px; margin: 0 auto 20px;
        }
        .portrait { 
            width: 220px; height: 220px; margin: 20px auto; 
            border-radius: 50%; background-size: cover; background-position: center;
            border: 3px solid #b48c46; position: relative; z-index: 2;
        }
        .portrait-frame {
            position: absolute; inset: 0;
            background: url('assets/stone_circle.png') center/contain no-repeat; /* Каменная крошка вокруг */
            z-index: 3; pointer-events: none;
        }

        /* Полоски статов */
        .bar-bg { width: 100%; height: 28px; background: #111; border: 1px solid #333; margin-top: 8px; position: relative; border-radius: 3px; }
        .bar-fill { height: 100%; transition: width 0.3s ease; }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 14px; line-height: 28px; font-weight: bold; text-shadow: 1px 1px 2px #000; z-index: 4; }

        .btn-ultra { 
            width: 100%; margin-top: 15px; padding: 15px; background: #311; 
            color: #555; border: 1px solid #422; font-family: 'Cinzel'; font-size: 20px; cursor: pointer;
        }
        .btn-ultra.ready { background: #611; color: #fff; border-color: #f44; box-shadow: 0 0 15px #f00; }

        .inv-grid {
            background: rgba(0,0,0,0.4); border: 1px solid #222; padding: 10px; margin-top: 15px; flex-grow: 1;
        }
        .inv-item { font-size: 13px; color: #888; border-bottom: 1px solid #222; padding: 5px 0; display: flex; justify-content: space-between; }

        .btn-shop { 
            background: transparent; border: 1px solid var(--border); color: var(--gold); 
            padding: 10px; margin: 15px 0; font-family: 'Cinzel'; font-size: 18px; cursor: pointer;
        }

        .stats-footer { background: #000; padding: 10px; border: 1px solid #321; }
        .stat-row { display: flex; justify-content: space-between; color: var(--gold); font-size: 18px; margin: 2px 0; }

        /* Оверлей меню */
        #menu-overlay { position: fixed; inset: 0; background: #000; z-index: 200; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .hero-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; }
        .hero-card { width: 250px; height: 250px; border-radius: 50%; border: 4px solid #444; cursor: pointer; background-size: cover; position: relative; transition: 0.3s; }
        .hero-card:hover { border-color: var(--gold); transform: scale(1.05); }
        .hero-card .label { position: absolute; bottom: -30px; width: 100%; text-align: center; font-family: 'Cinzel'; color: var(--gold); }
    </style>
</head>
<body>

    <div id="menu-overlay">
        <h1 style="color:var(--gold); font-size: 50px; font-family: 'Cinzel';">TAVERNA WAR</h1>
        <div class="hero-cards">
            <div class="hero-card" style="background-image: url('assets/boss3.png');" onclick="startGame('warrior')"><div class="label">ВОИН</div></div>
            <div class="hero-card" style="background-image: url('assets/mob9.png');" onclick="startGame('mage')"><div class="label">МАГ</div></div>
            <div class="hero-card" style="background-image: url('assets/mob10.png');" onclick="startGame('archer')"><div class="label">ЛУЧНИК</div></div>
            <div class="hero-card" style="background-image: url('assets/mob15.png');" onclick="startGame('assassin')"><div class="label">УБИЙЦА</div></div>
        </div>
    </div>

    <div id="ui-left">
        <div class="portrait-container">
            <div id="p-portrait" class="portrait"></div>
            <div class="portrait-frame"></div>
        </div>
        
        <div class="bar-bg"><div id="p-arm-t" class="bar-text">Броня: 0 / 0</div><div id="p-arm-f" class="bar-fill" style="background: #444;"></div></div>
        <div class="bar-bg"><div id="p-hp-t" class="bar-text">1600 / 1600</div><div id="p-hp-f" class="bar-fill" style="background: #e22;"></div></div>
        <div class="bar-bg"><div id="p-mn-t" class="bar-text">Мана: 0%</div><div id="p-mn-f" class="bar-fill" style="background: #22e;"></div></div>
        
        <button id="btn-ultra" class="btn-ultra">СУПЕРУДАР</button>
        
        <div id="inv-box" class="inv-grid"></div>
        
        <button class="btn-shop">МАГАЗИН</button>
        
        <div class="stats-footer">
            <div class="stat-row"><span>Сила:</span><span id="stat-atk">37</span></div>
            <div class="stat-row"><span>Уворот:</span><span id="stat-dodge">5%</span></div>
            <div class="stat-row"><span>Золото:</span><span id="gold-val" style="color:#ffd700">0</span></div>
        </div>
    </div>

    <div id="game-container"></div>

    <div id="ui-right">
        <div class="portrait-container">
            <div id="m-portrait" class="portrait"></div>
            <div class="portrait-frame"></div>
        </div>
        <h2 id="m-name" style="text-align:center; font-family:'Cinzel'; color:#f44;">ВРАГ</h2>
        <div class="bar-bg"><div id="m-hp-t" class="bar-text">0 / 0</div><div id="m-hp-f" class="bar-fill" style="background: #e22;"></div></div>
        <div class="bar-bg"><div id="m-mn-t" class="bar-text">Мана: 0%</div><div id="m-mn-f" class="bar-fill" style="background: #22e;"></div></div>
        <div id="battle-log" style="margin-top:20px; font-size:12px; height:200px; overflow-y:auto; color:#aaa; border-top:1px solid #333; padding-top:10px;"></div>
    </div>

    <script>
    const TILE_S = 80;
    const VISUAL_S = 72;
    let phaserGame, scene;

    window.app = {
        player: null, mob: null, turn: "PLAYER",
        log: (msg, type) => {
            const log = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.innerText = `> ${msg}`;
            log.prepend(entry);
        }
    };

    function startGame(key) {
        document.getElementById('menu-overlay').style.display = 'none';
        const base = { 'warrior':{hp:1600,atk:37,agi:5,img:'boss3.png'}, 'mage':{hp:800,atk:65,agi:2,img:'mob9.png'}, 'archer':{hp:1000,atk:40,agi:18,img:'mob10.png'}, 'assassin':{hp:900,atk:55,agi:14,img:'mob15.png'} }[key];
        
        window.app.player = { job:key, hp:base.hp, maxHp:base.hp, armor:0, maxArmor:0, mana:0, gold:0, baseAtk:base.atk, baseAgi:base.agi, equip: { weapon:{n:"Старая палка",atk:12,arm:0,agi:0,rar:0} } };
        
        document.getElementById('p-portrait').style.backgroundImage = `url('assets/${base.img}')`;
        initPhaser(); spawnMob(); refreshUI();
    }

    function spawnMob() {
        const mobId = Math.floor(Math.random() * 15) + 1;
        window.app.mob = { name: "Существо", hp: 500, maxHp: 500, atk: 30, mana: 0, img: `mob${mobId}.png` };
        document.getElementById('m-portrait').style.backgroundImage = `url('assets/${window.app.mob.img}')`;
        refreshUI();
    }

    function refreshUI() {
        const p = window.app.player; const m = window.app.mob;
        if(!p || !m) return;

        document.getElementById('p-hp-t').innerText = `${Math.floor(p.hp)}/${p.maxHp}`;
        document.getElementById('p-hp-f').style.width = (p.hp/p.maxHp*100)+'%';
        document.getElementById('m-hp-t').innerText = `${Math.floor(m.hp)}/${m.maxHp}`;
        document.getElementById('m-hp-f').style.width = (m.hp/m.maxHp*100)+'%';
        
        let invH = "";
        const slots = {weapon:"Оружие", body:"Доспех", legs:"Поножи", head:"Шлем", ring:"Перстень", neck:"Амулет", hands:"Перчатки"};
        for(let s in slots) {
            let item = p.equip[s] || null;
            invH += `<div class="inv-item"><span>${slots[s]}: ${item?item.n:'---'}</span> <span>${item?'⚔️'+item.atk:''}</span></div>`;
        }
        document.getElementById('inv-box').innerHTML = invH;
    }

    class GameScene extends Phaser.Scene {
        constructor() { super('GameScene'); }
        preload() {
            // Загрузка рун как на скриншоте
            for(let i=1; i<=5; i++) this.load.image(`rune${i}`, `assets/rune${i}.png`);
        }
        create() {
            scene = this; this.grid = [];
            for(let r=0; r<8; r++) {
                this.grid[r] = [];
                for(let c=0; c<8; c++) this.spawnTile(r, c);
            }
        }
        spawnTile(r, c) {
            let id = Phaser.Math.Between(1, 5);
            let x = c * TILE_S + TILE_S/2;
            let y = r * TILE_S + TILE_S/2;
            
            let container = this.add.container(x, y);
            let bg = this.add.graphics();
            bg.fillStyle(0x1a1a1a, 1);
            bg.fillRoundedRect(-VISUAL_S/2, -VISUAL_S/2, VISUAL_S, VISUAL_S, 8);
            
            let img = this.add.image(0, 0, `rune${id}`).setDisplaySize(VISUAL_S-10, VISUAL_S-10);
            
            let frame = this.add.graphics();
            frame.lineStyle(2, 0x333333);
            frame.strokeRoundedRect(-VISUAL_S/2, -VISUAL_S/2, VISUAL_S, VISUAL_S, 8);
            
            container.add([bg, img, frame]);
            this.grid[r][c] = container;
        }
    }

    function initPhaser() { 
        phaserGame = new Phaser.Game({ 
            type: Phaser.AUTO, 
            parent: 'game-container', 
            width: 640, height: 640, 
            scene: GameScene, 
            transparent: true 
        }); 
    }
    </script>
</body>
</html>
